using System;
using System.Linq;
using System.Threading.Tasks;
using Bitcoin.Api.Client.AutoGenerated;
using Bitcoin.Api.Client.AutoGenerated.Models;
using Bitcoin.Api.Client.BitcoinApi.Models;

// ReSharper disable once CheckNamespace
namespace Bitcoin.Api.Client.BitcoinApi
{
    public partial class BitcoinApiClient : IBitcoinApiClient
    {
        private readonly AutoGenerated.BitcoinApi _apiClient;

        public BitcoinApiClient(string apiUrl)
        {
            _apiClient = new AutoGenerated.BitcoinApi(new Uri(apiUrl));
            _apiClient.SetRetryPolicy(null);
        }

        private T PrepareResult<T>(object response, Func<object, T> convert) where T : Response
        {
            if (response is ApiException error)
            {
                var instance = Activator.CreateInstance<T>();
                instance.Error = new ErrorResponse { Code = error.Error.Code, Message = error.Error.Message };
                return instance;
            }
            var converted = convert(response);
            if (converted != null)
                return converted;
            throw new ArgumentException("Unkown response object");
        }
    }
}
